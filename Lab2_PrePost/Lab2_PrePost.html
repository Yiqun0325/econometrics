<!DOCTYPE html>
<html>

<head>

<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>Lab2_PrePost</title>


<style type="text/css">
body {
  font-family: Helvetica, arial, sans-serif;
  font-size: 14px;
  line-height: 1.6;
  padding-top: 10px;
  padding-bottom: 10px;
  background-color: white;
  padding: 30px; }

body > *:first-child {
  margin-top: 0 !important; }
body > *:last-child {
  margin-bottom: 0 !important; }

a {
  color: #4183C4; }
a.absent {
  color: #cc0000; }
a.anchor {
  display: block;
  padding-left: 30px;
  margin-left: -30px;
  cursor: pointer;
  position: absolute;
  top: 0;
  left: 0;
  bottom: 0; }

h1, h2, h3, h4, h5, h6 {
  margin: 20px 0 10px;
  padding: 0;
  font-weight: bold;
  -webkit-font-smoothing: antialiased;
  cursor: text;
  position: relative; }

h1:hover a.anchor, h2:hover a.anchor, h3:hover a.anchor, h4:hover a.anchor, h5:hover a.anchor, h6:hover a.anchor {
  background: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA09pVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMy1jMDExIDY2LjE0NTY2MSwgMjAxMi8wMi8wNi0xNDo1NjoyNyAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNiAoMTMuMCAyMDEyMDMwNS5tLjQxNSAyMDEyLzAzLzA1OjIxOjAwOjAwKSAgKE1hY2ludG9zaCkiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6OUM2NjlDQjI4ODBGMTFFMTg1ODlEODNERDJBRjUwQTQiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6OUM2NjlDQjM4ODBGMTFFMTg1ODlEODNERDJBRjUwQTQiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDo5QzY2OUNCMDg4MEYxMUUxODU4OUQ4M0REMkFGNTBBNCIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDo5QzY2OUNCMTg4MEYxMUUxODU4OUQ4M0REMkFGNTBBNCIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PsQhXeAAAABfSURBVHjaYvz//z8DJYCRUgMYQAbAMBQIAvEqkBQWXI6sHqwHiwG70TTBxGaiWwjCTGgOUgJiF1J8wMRAIUA34B4Q76HUBelAfJYSA0CuMIEaRP8wGIkGMA54bgQIMACAmkXJi0hKJQAAAABJRU5ErkJggg==) no-repeat 10px center;
  text-decoration: none; }

h1 tt, h1 code {
  font-size: inherit; }

h2 tt, h2 code {
  font-size: inherit; }

h3 tt, h3 code {
  font-size: inherit; }

h4 tt, h4 code {
  font-size: inherit; }

h5 tt, h5 code {
  font-size: inherit; }

h6 tt, h6 code {
  font-size: inherit; }

h1 {
  font-size: 28px;
  color: black; }

h2 {
  font-size: 24px;
  border-bottom: 1px solid #cccccc;
  color: black; }

h3 {
  font-size: 18px; }

h4 {
  font-size: 16px; }

h5 {
  font-size: 14px; }

h6 {
  color: #777777;
  font-size: 14px; }

p, blockquote, ul, ol, dl, li, table, pre {
  margin: 15px 0; }

hr {
  background: transparent url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAYAAAAECAYAAACtBE5DAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyJpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNSBNYWNpbnRvc2giIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6OENDRjNBN0E2NTZBMTFFMEI3QjRBODM4NzJDMjlGNDgiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6OENDRjNBN0I2NTZBMTFFMEI3QjRBODM4NzJDMjlGNDgiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDo4Q0NGM0E3ODY1NkExMUUwQjdCNEE4Mzg3MkMyOUY0OCIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDo4Q0NGM0E3OTY1NkExMUUwQjdCNEE4Mzg3MkMyOUY0OCIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PqqezsUAAAAfSURBVHjaYmRABcYwBiM2QSA4y4hNEKYDQxAEAAIMAHNGAzhkPOlYAAAAAElFTkSuQmCC) repeat-x 0 0;
  border: 0 none;
  color: #cccccc;
  height: 4px;
  padding: 0;
}

body > h2:first-child {
  margin-top: 0;
  padding-top: 0; }
body > h1:first-child {
  margin-top: 0;
  padding-top: 0; }
  body > h1:first-child + h2 {
    margin-top: 0;
    padding-top: 0; }
body > h3:first-child, body > h4:first-child, body > h5:first-child, body > h6:first-child {
  margin-top: 0;
  padding-top: 0; }

a:first-child h1, a:first-child h2, a:first-child h3, a:first-child h4, a:first-child h5, a:first-child h6 {
  margin-top: 0;
  padding-top: 0; }

h1 p, h2 p, h3 p, h4 p, h5 p, h6 p {
  margin-top: 0; }

li p.first {
  display: inline-block; }
li {
  margin: 0; }
ul, ol {
  padding-left: 30px; }

ul :first-child, ol :first-child {
  margin-top: 0; }

dl {
  padding: 0; }
  dl dt {
    font-size: 14px;
    font-weight: bold;
    font-style: italic;
    padding: 0;
    margin: 15px 0 5px; }
    dl dt:first-child {
      padding: 0; }
    dl dt > :first-child {
      margin-top: 0; }
    dl dt > :last-child {
      margin-bottom: 0; }
  dl dd {
    margin: 0 0 15px;
    padding: 0 15px; }
    dl dd > :first-child {
      margin-top: 0; }
    dl dd > :last-child {
      margin-bottom: 0; }

blockquote {
  border-left: 4px solid #dddddd;
  padding: 0 15px;
  color: #777777; }
  blockquote > :first-child {
    margin-top: 0; }
  blockquote > :last-child {
    margin-bottom: 0; }

table {
  padding: 0;border-collapse: collapse; }
  table tr {
    border-top: 1px solid #cccccc;
    background-color: white;
    margin: 0;
    padding: 0; }
    table tr:nth-child(2n) {
      background-color: #f8f8f8; }
    table tr th {
      font-weight: bold;
      border: 1px solid #cccccc;
      margin: 0;
      padding: 6px 13px; }
    table tr td {
      border: 1px solid #cccccc;
      margin: 0;
      padding: 6px 13px; }
    table tr th :first-child, table tr td :first-child {
      margin-top: 0; }
    table tr th :last-child, table tr td :last-child {
      margin-bottom: 0; }

img {
  max-width: 100%; }

span.frame {
  display: block;
  overflow: hidden; }
  span.frame > span {
    border: 1px solid #dddddd;
    display: block;
    float: left;
    overflow: hidden;
    margin: 13px 0 0;
    padding: 7px;
    width: auto; }
  span.frame span img {
    display: block;
    float: left; }
  span.frame span span {
    clear: both;
    color: #333333;
    display: block;
    padding: 5px 0 0; }
span.align-center {
  display: block;
  overflow: hidden;
  clear: both; }
  span.align-center > span {
    display: block;
    overflow: hidden;
    margin: 13px auto 0;
    text-align: center; }
  span.align-center span img {
    margin: 0 auto;
    text-align: center; }
span.align-right {
  display: block;
  overflow: hidden;
  clear: both; }
  span.align-right > span {
    display: block;
    overflow: hidden;
    margin: 13px 0 0;
    text-align: right; }
  span.align-right span img {
    margin: 0;
    text-align: right; }
span.float-left {
  display: block;
  margin-right: 13px;
  overflow: hidden;
  float: left; }
  span.float-left span {
    margin: 13px 0 0; }
span.float-right {
  display: block;
  margin-left: 13px;
  overflow: hidden;
  float: right; }
  span.float-right > span {
    display: block;
    overflow: hidden;
    margin: 13px auto 0;
    text-align: right; }

code, tt {
  margin: 0 2px;
  padding: 0 5px;
  white-space: nowrap;
  border: 1px solid #eaeaea;
  background-color: #f8f8f8;
  border-radius: 3px; }

pre code {
  margin: 0;
  padding: 0;
  white-space: pre;
  border: none;
  background: transparent; }

.highlight pre {
  background-color: #f8f8f8;
  border: 1px solid #cccccc;
  font-size: 13px;
  line-height: 19px;
  overflow: auto;
  padding: 6px 10px;
  border-radius: 3px; }

pre {
  background-color: #f8f8f8;
  border: 1px solid #cccccc;
  font-size: 13px;
  line-height: 19px;
  overflow: auto;
  padding: 6px 10px;
  border-radius: 3px; }
  pre code, pre tt {
    background-color: transparent;
    border: none; }

sup {
    font-size: 0.83em;
    vertical-align: super;
    line-height: 0;
}

kbd {
  display: inline-block;
  padding: 3px 5px;
  font-size: 11px;
  line-height: 10px;
  color: #555;
  vertical-align: middle;
  background-color: #fcfcfc;
  border: solid 1px #ccc;
  border-bottom-color: #bbb;
  border-radius: 3px;
  box-shadow: inset 0 -1px 0 #bbb
}

* {
	-webkit-print-color-adjust: exact;
}
@media screen and (min-width: 914px) {
    body {
        width: 854px;
        margin:0 auto;
    }
}
@media print {
	table, pre {
		page-break-inside: avoid;
	}
	pre {
		word-wrap: break-word;
	}
}
</style>


</head>

<body>

<h1 id="toc_0">Lab 2. Pre Post</h1>

<p>Econometrics 409A<br>
August XX, 2019</p>

<h3 id="toc_1">Goal: To estimate OLS regression models in Stata for pre-post study designs</h3>

<h3 id="toc_2">Objectives:</h3>

<ol>
<li>Estimate and interpret a regression model for a pre-post study</li>
<li>Complete a difference-in-differences table by hand</li>
</ol>

<h3 id="toc_3">Research Questions:</h3>

<ol>
<li>Was there a wage difference between 1978 and 1985, controlling for other factors? Did this difference differ by gender?</li>
</ol>

<h3 id="toc_4">Dataset:</h3>

<p>Pooled cross sectional dataset of individuals’ hourly wages and related predictors of two time periods, 1978 and 1985. (N= 1,084 observations)</p>

<h3 id="toc_5">Model:</h3>

<p><img src="http://latex.codecogs.com/gif.latex?Log%28wage%29%20%3D%20B_0%20&plus;%20B_1y85%20&plus;%20B_2female%20&plus;%20B_3y85*female%20&plus;%20B_4educ%20&plus;%20B_5exper%20&plus;%20B_6expersq%20&plus;%20B_7union%20&plus;%20u" /></p>

<h4 id="toc_6">Preliminary steps in Stata:</h4>

<ul>
<li><strong>Download/unzip</strong> the Lab2_PrePost folder from LATTE<br></li>
<li><strong>Open</strong> PrePost.do<br></li>
<li>Set your working directory and open the Wages.dta dataset:</li>
</ul>

<div><pre><code class="language-none">        cd &quot;C:\Heller\409A\Lab2_PrePost&quot;  
        use &quot;Wage.dta&quot;, clear </code></pre></div>

<h4 id="toc_7">Descriptive Statistics</h4>

<div><pre><code class="language-none">    summarize  
    codebook, compact  
    bysort year: sum wage  
    sdtest wage, by(year)  
    ttest wage, by(year) unequal  </code></pre></div>

<h4 id="toc_8">Log Transformation</h4>

<ul>
<li>Do wages follow a normal distribution?<br></li>
</ul>

<div><pre><code class="language-none">    hist wage, norm
    qnorm wage</code></pre></div>

<ul>
<li>If data were normally distributed, but variances were unequal (as determined by the sdtest), you could do a ttest for unequal variances (ttest with unequal option).<br></li>
</ul>

<div><pre><code class="language-none">    ttest wage, by(year) unequal</code></pre></div>

<ul>
<li>However, there are alternatives that are preferred in the case of skewed data.<br>
Log-transformation of the skewed variable, check for normality and equal variance, conduct t-test:</li>
</ul>

<div><pre><code class="language-none">    qnorm lwage
    sdtest lwage, by(year)
    ttest lwage, by(year)</code></pre></div>

<h4 id="toc_9">Pooled model design for pre-post analysis</h4>

<ul>
<li>Start with an overall model pooling both years together (i.e. do not put year in the model)
<img src="http://latex.codecogs.com/gif.latex?Log%28wage%29%20%3D%20B_0%20&plus;%20B_1female%20&plus;%20B_2educ%20&plus;%20B_3exper%20&plus;%20B_4expersq%20&plus;%20B_5union%20&plus;%20u" /><br></li>
</ul>

<div><pre><code class="language-none">    regress lwage female educ exper expersq union
    estimates store m1</code></pre></div>

<ul>
<li>for larger coefficients, exponentiate the coefficient and subtract to interpret a percentage change.</li>
</ul>

<div><pre><code class="language-none">    di exp(-.25)-1</code></pre></div>

<ul>
<li>Now add in a covariate to control for survey year (y85)
<img src="http://latex.codecogs.com/gif.latex?Log%28wage%29%20%3D%20B_0%20&plus;%20B_1y85%20&plus;%20B_2female%20&plus;%20B_3educ%20&plus;%20B_4exper%20&plus;%20B_5expersq%20&plus;%20B_6union%20&plus;%20u" /><br></li>
</ul>

<div><pre><code class="language-none">    regress lwage y85 female educ exper expersq union
    estimates store m2</code></pre></div>

<ul>
<li>Let&#39;s compare models in a table<br></li>
</ul>

<div><pre><code class="language-none">    esttab m1 m2, b(%7.4f) se star stats(N r2 r2_a)</code></pre></div>

<ul>
<li>I hypothosize that the difference in wages between females and males may have changed between 1978 and 1985</li>
</ul>

<div><pre><code class="language-none">    table year female, c(mean lwage)</code></pre></div>

<ul>
<li>It appears that the difference may have declined between 1978 and 1985. To test this formally, we include an interaction term:</li>
<li>Let&#39;s create an interaction term</li>
</ul>

<div><pre><code class="language-none">    gen y85fem = y85*female
    label var y85fem &quot;Females in 1985&quot;</code></pre></div>

<p><img src="http://latex.codecogs.com/gif.latex?Log%28wage%29%20%3D%20B_0%20&plus;%20B_1y85%20&plus;%20B_2female%20&plus;%20B_3y85fem%20&plus;%20B_4educ%20&plus;%20B_5exper%20&plus;%20B_6expersq%20&plus;%20B_6union%20&plus;%20u" /></p>

<div><pre><code class="language-none">    regress lwage y85 female y85fem educ exper expersq union 
    estimates store m3</code></pre></div>

<ul>
<li>Now compare all three models:</li>
</ul>

<div><pre><code class="language-none">    esttab m1 m2 m3, b(%7.4f) se star stats(N r2 r2_a)</code></pre></div>

<h4 id="toc_10">Differences-in-differences table</h4>

<ul>
<li>Let&#39;s focus on Model 3</li>
<li>Predicted means (in log-wages) for each group</li>
<li>Use these values to find the D-i-D effect:</li>
</ul>

<div><pre><code class="language-none">* Men in &#39;78 -- reference group:
    margins, at(y85=0 female=0 y85fem=0)

* Women in &#39;78
    margins, at(y85=0 female=1 y85fem=0)

* Men in &#39;85
    margins, at(y85=1 female=0 y85fem=0)

* Women in &#39;85
    margins, at(y85=1 female=1 y85fem=1)
    
* difference between men and women in 1978:
    di 1.807-1.487
    
* difference between men and women in 1985:
    di 2.160-1.929
    
* difference-in-difference:
    di 0.32 - 0.231</code></pre></div>

<ul>
<li>Another equivalent option to get the same values: use Stata&#39;s factor notation. Factor notation will help when using margins.</li>
</ul>

<div><pre><code class="language-none">    reg lwage y85##female educ exper expersq union 
    margins y85#female</code></pre></div>

<ul>
<li>Margins plot is a nice way to visualize the results from the margins table.</li>
</ul>

<div><pre><code class="language-none">    marginsplot </code></pre></div>

<ul>
<li>If you want to create an interaction term with a continious variable (e.g. experience), you will need to put a &#39;c.&#39; in front (we will remove the quadratic term to simplify):</li>
</ul>

<div><pre><code class="language-none">    regress lwage female c.exper##y85 educ union </code></pre></div>

<ul>
<li>for margins, specify what levels of the continous variable you are interested in. Note: any covariates ommitted will be set at their means by default.</li>
</ul>

<div><pre><code class="language-none">    margins y85, at(exper=(1 4 10 20))</code></pre></div>

<ul>
<li>we may also want set another variable in the model at a specific value, e.g., union members</li>
</ul>

<div><pre><code class="language-none">    margins y85, at(exper=(1 4 10 20) union=1)
    marginsplot</code></pre></div>

<ul>
<li>From the plot, it looks like the effect of experience on wages is about the same in 1978 as it was in 1985. This is confirmed by the fact that our interaction term in the regression model is very small and not signficant.</li>
</ul>

<h4 id="toc_11">Regression with centered variables</h4>

<ul>
<li>Sometimes, we center variables on a meaningful value for easier interpretation.  For instance, we may center a “years of education” variable at 12 years.  Doing so would allow us to interpret the variable’s beta coefficient as the effect of an additional year of college education, holding everything else constant.  Below is an example of generating a new education variable centered at the 12th year.</li>
</ul>

<div><pre><code class="language-none">    gen c_educ= (educ-12)
    regress lwage y85 female y85fem c_educ exper expersq union</code></pre></div>

<ul>
<li>Now, we interpret the coefficeint on <em>female</em> as when y85=0, y85fem = 0 , c<em>educ = 0, exper = 0, and expersq = 0. eg, the difference in log wages between females and males in 1978 (y85=0 and y85fem = 0) <em>for people with a high school education</em> (c</em>educ=0) without any experience (exper = 0 and expersq = 0).</li>
</ul>

<h4 id="toc_12">Extra</h4>

<ul>
<li>Why do we have an experience squared term in the model?</li>
</ul>

<div><pre><code class="language-none">    twoway (scatter lwage exper) (qfit lwage exper) (lfit lwage exper)</code></pre></div>

<ul>
<li>From the quadratic fit line (red) it looks like people with many years of experience start to see reduced wages.</li>
<li>Find the turning point (i.e. when experience starts to have a negative effect on wage)</li>
</ul>

<div><pre><code class="language-none">    estimates restore m3
    nlcom -_b[exper]/(2*_b[expersq])
    *or 
    display = -(.0294761)/(2*-.0003975)</code></pre></div>

<p><strong>Another method for D-i-D: Stratified approach:</strong></p>

<ul>
<li>We could also stratify by gender and fit a pair of separate models:</li>
<li>one for the males and one for the females in the sample</li>
<li>Model for men (if female==0)</li>
</ul>

<div><pre><code class="language-none">    reg lwage y85 educ exper expersq union if female==0
    est store mm</code></pre></div>

<ul>
<li>Model for women (if female==1)</li>
</ul>

<div><pre><code class="language-none">    reg lwage y85 educ exper expersq union if female==1
    est store mf</code></pre></div>

<ul>
<li>Compare estimates from each model.</li>
<li>Which coefficients are different? What does it mean?</li>
</ul>

<div><pre><code class="language-none">    esttab mm mf, b(%7.4f) se star stats(N r2 r2_a)</code></pre></div>

<ul>
<li>Now we can generate predicted values from each model to complete our D-i-D analysis like we did in the pooled approach</li>
<li>Need to restore results from first stratified model (men) to get the predicted values.</li>
</ul>

<div><pre><code class="language-none">    est restore mm
    margins, at(y85=0)
    margins, at(y85=1)</code></pre></div>

<ul>
<li>And now restore results from the second model (women) and get the predicted values</li>
</ul>

<div><pre><code class="language-none">    est restore mf
    margins, at(y85=0)
    margins, at(y85=1)</code></pre></div>



<script type="text/x-mathjax-config">
(function () {

MathJax.Hub.Config({
	'showProcessingMessages': false,
	'messageStyle': 'none'
});

if (typeof MathJaxListener !== 'undefined') {
	MathJax.Hub.Register.StartupHook('End', function () {
		MathJaxListener.invokeCallbackForKey_('End');
	});
}

})();
</script>

<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>


</body>

</html>
